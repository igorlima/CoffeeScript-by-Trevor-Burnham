(function(){this.Scrabble=function(){function g(){}g.defaultView=function(){return{PLAYER:{ONE:{SCORE:"p1score",NAME:"p1name"},TWO:{SCORE:"p2score",NAME:"p2name"}},MESSAGE:"message",GRID:"grid"}};return g}()}).call(this);
(function(){var g,k,l,c,f,a;g=this.Scrabble.Tile=function(){return function(){}}();f={A:9,B:2,C:2,D:4,E:12,F:2,G:3,H:2,I:9,J:1,K:1,L:4,M:2,N:6,O:8,P:2,Q:1,R:6,S:4,T:6,U:4,V:2,W:2,X:1,Y:2,Z:1};a=0;for(c in f)l=f[c],a+=l;k=function(){var b;b=[];for(c in f)b.push(c);return b}().sort();g.total=function(){return a};g.alphabet=function(){return k.slice(0)};g.randomLetter=function(){var b,d,e,h;b=Math.ceil(Math.random()*a);d=1;e=0;for(h=k.length;e<h;e++)if(c=k[e],d+=f[c],d>b)return c}}).call(this);
(function(){var g,k,l,c,f=[].indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(b in this&&this[b]===a)return b;return-1};k=this.Scrabble.TileFinder=function(){return function(){}}();g=k.MIN_TILE_LENGTH=2;c=function(a,b){var d,e,h,c;e=a.range;h="";for(d=c=0;0<=e?c<e:c>e;d=0<=e?++c:--c)d=b(d),null!=d&&(h+=d);if(h.length===e)return h};l=function(a,b){var d,e,h,c,q,k;e=a.range;c=[];for(h=q=g;g<=e?q<=e:q>=e;h=g<=e?++q:--q)for(d=k=0;0<=h?k<h:k>h;d=0<=h?++k:--k)d=b(h,d),null==d||0<=f.call(c,d)||
c.push(d);return c};k.verticalOne=function(a){var b,d,e,h;d=a.grid;e=a.range;b=a.x;h=a.y;return c({grid:d,range:e,x:b,y:h},function(a){var e;return null!=(e=d[h+a])?e[b]:void 0})};k.horizontalOne=function(a){var b,d,e,h;d=a.grid;e=a.range;b=a.x;h=a.y;return c({grid:d,range:e,x:b,y:h},function(a){var e;return null!=(e=d[h])?e[b+a]:void 0})};k.diagonalOne_upperLeft_to_lowerRight=function(a){var b,d,e,h;d=a.grid;e=a.range;b=a.x;h=a.y;return c({grid:d,range:e,x:b,y:h},function(a){var e;return null!=(e=
d[h+a])?e[b+a]:void 0})};k.diagonalOne_lowerLeft_to_upperRight=function(a){var b,d,e,h;d=a.grid;e=a.range;b=a.x;h=a.y;return c({grid:d,range:e,x:b,y:h},function(a){var e;return null!=(e=d[h-a])?e[b+a]:void 0})};k.verticalTiles=function(a){var b,d,e,h;b=a.grid;d=a.range;e=a.x;h=a.y;return l({grid:b,range:d,x:e,y:h},function(a,d){return k.verticalOne({grid:b,x:e,y:h-d,range:a})})};k.horizontalTiles=function(a){var b,d,e,h;b=a.grid;d=a.range;e=a.x;h=a.y;return l({grid:b,range:d,x:e,y:h},function(a,d){return k.horizontalOne({grid:b,
x:e-d,y:h,range:a})})};k.diagonalTiles_upperLeft_to_lowerRight=function(a){var b,d,e,h;b=a.grid;d=a.range;e=a.x;h=a.y;return l({grid:b,range:d,x:e,y:h},function(a,d){return k.diagonalOne_upperLeft_to_lowerRight({grid:b,x:e-d,y:h-d,range:a})})};k.diagonalTiles_lowerLeft_to_upperRight=function(a){var b,d,e,h;b=a.grid;d=a.range;e=a.x;h=a.y;return l({grid:b,range:d,x:e,y:h},function(a,d){return k.diagonalOne_lowerLeft_to_upperRight({grid:b,x:e-d,y:h+d,range:a})})};k.all=function(a){var b,d,e,h,c,g,k,
l,m,n,p;d=a.grid;e=a.range;c=a.x;g=a.y;a=[];p=[this.verticalTiles,this.horizontalTiles,this.diagonalTiles_upperLeft_to_lowerRight,this.diagonalTiles_lowerLeft_to_upperRight];k=0;for(m=p.length;k<m;k++)for(b=p[k],h=b({grid:d,range:e,x:c,y:g}),l=0,n=h.length;l<n;l++)b=h[l],0>f.call(a,b)&&a.push(b);return a}}).call(this);
(function(){var g,k,l=[].indexOf||function(c){for(var f=0,a=this.length;f<a;f++)if(f in this&&this[f]===c)return f;return-1};g=this.Scrabble;k=g.TileFinder;g.WordFinder=function(){function c(){}c.isWord=function(c){return 0<=l.call(c.dictionary,c.word)};c.all=function(c){var a,b,d,e,h;b=c.grid;a=c.dictionary;c=k.all({grid:b,dictionary:a,range:c.range,x:c.x,y:c.y});h=[];d=0;for(e=c.length;d<e;d++)b=c[d],this.isWord({word:b,dictionary:a})&&h.push(b);return h};return c}()}).call(this);
(function(){var g,k,l;g=this.Scrabble;k=g.Tile;l=g.TileFinder;g=g.Util=function(){return function(){}}();g.isInteger=function(c){return c===Math.round(c)};g.inRange=function(c){var f,a,b;a=c.value;f=c.range;b=c.x;c=c.y;if(null!=a)return this.isInteger(a)&&0<=a&&a<f;if(null!=b&&null!=c)return this.inRange({value:b,range:f})&&this.inRange({value:c,range:f})};g.setCoordinate=function(c){var f,a,b,d;f=c.coordinates;a=c.range;b=c.x;d=c.y;c=c.value;f[b]||(f[b]=[]);this.inRange({value:b,range:a})&&this.inRange({value:d,
range:a})?f[b][d]=c:f[b][d]=void 0;return!!f[b][d]};g.getCoordinate=function(c){return c.coordinates[c.x][c.y]};g.generateGrid=function(c){var f,a;a=[];for(f=0;0<=c?f<c:f>c;0<=c?++f:--f)a.push(function(){var b,a;a=[];for(b=0;0<=c?b<c:b>c;0<=c?++b:--b)a.push(k.randomLetter());return a}());return a};g.printGrid=function(c){var f;f=this.matrix(c);var a,b,d;d=[];a=0;for(b=f.length;a<b;a++)c=f[a],d.push(" "+c.join(" | "));return d.join("\n")};g.matrix=function(c){var f,a,b,d,e;e=[];f=b=0;for(d=c.length;0<=
d?b<d:b>d;f=0<=d?++b:--b)e.push(function(){var b,d,e;e=[];a=b=0;for(d=c[f].length;0<=d?b<d:b>d;a=0<=d?++b:--b)e.push(c[f][a]);return e}());return e};g.wordList=function(c){var f,a,b,d,e,h;f=c.size;a=c.words;h=[];b=0;for(d=a.length;b<d;b++)c=a[b],l.MIN_TILE_LENGTH<=(e=c.length)&&e<=f&&h.push(c);return h};g.isMatrixQuadratic=function(c){var f,a,b;if(!c)return!1;a=0;for(b=c.length;a<b;a++)if(f=c[a],c.length!==f.length)return!1;return!0};g.sizeMatrix=function(c){if(this.isMatrixQuadratic(c))return c.length};
g.isValidSwapCoordinates=function(c){var f,a,b,d,e,h;b=c.x1;e=c.y1;d=c.x2;h=c.y2;c=c.range;f=Math.abs(d-b);a=Math.abs(h-e);return(f=0<f&&0<a?!1:1===f||1===a)&&null!=c?this.inRange({x:b,y:e,range:c})&&this.inRange({x:d,y:h,range:c}):f};g.createSwapCoordinate=function(c,f){return{x1:c.x,y1:c.y,x2:f.x,y2:f.y}};g.createSwipeCoordinate=function(c,f){var a,b,d,e;a=c.x;d=c.y;b=f.x;e=f.y;null!=b&&(a+=b);null!=e&&(d+=e);return{x:a,y:d}};g.Message=function(){function c(){}var f;f=function(a){var b,d;b=a.player;
a=a.score;return{name:null!=b?"function"===typeof b.name?b.name():void 0:void 0,numberWords:null!=a?null!=(d=a.newWords)?d.length:void 0:void 0,points:null!=a?a.points:void 0,words:(null!=a?a.newWords:void 0)||[]}};c.points=function(a){var b;b=a.player;b=f({player:b,score:a.score});a=""+b.name+" formed the following "+b.numberWords+" word(s): ";a+=""+b.words+". ";return a+("Earning "+b.points+" points")};c.tile=function(a){a=(null!=a?a.coordinate:void 0)||{};return"Tile ("+a.x+", "+a.y+") selected"};
return c}()}).call(this);
(function(){this.Scrabble.Player=function(){return function(g){var k,l,c,f;l=(null!=g?g:{}).name;g=[0,0,[]];c=g[0];k=g[1];f=g[2];this.name=function(){return l};this.score=function(){return c};this.moveCount=function(){return k};this.words=function(){var a,b,d,e;e=[];b=0;for(d=f.length;b<d;b++)a=f[b],e.push(a);return e};this.move=function(a){var b;b=null!=a?a:{};a=b.board;b=b.swapCoordinates;if(null!=a||null!=b)return a=a.move(b),null!=a&&(k++,c+=a.points,f.push.apply(f,a.newWords)),a}}}()}).call(this);
(function(){var g,k,l,c,f,a=[].indexOf||function(b){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===b)return a;return-1};k=this.Scrabble;l=k.Util;f=k.WordFinder;c={A:1,B:3,C:3,D:2,E:1,F:4,G:2,H:4,I:1,J:8,K:5,L:1,M:3,N:1,O:1,P:3,Q:10,R:1,S:1,T:1,U:1,V:4,W:4,X:8,Y:4,Z:10};g=k.Score=function(){return function(b){var d,e;e=b.grid;d=b.dictionary;this.printGrid=function(){return l.printGrid(e)};this.matrix=function(){return l.matrix(e)};this.moveScore=function(b){return g.moveScore({grid:e,dictionary:d,
swapCoordinates:b})};this.scoreWord=function(b){return 0<=a.call(d,b)?g.scoreWord(b):0};this.words=function(){return g.words({grid:e,dictionary:d})}}}();g.words=function(b){var d,e,c,g,k,l,r,m,n,p;e=b.grid;b=b.dictionary;d=[[],e.length];g=d[0];d=d[1];for(l=r=0;0<=d?r<d:r>d;l=0<=d?++r:--r)for(c=m=0;0<=d?m<d:m>d;c=0<=d?++m:--m)for(k=f.all({grid:e,dictionary:b,x:l,y:c,range:d}),n=0,p=k.length;n<p;n++)c=k[n],0>a.call(g,c)&&g.push(c);return g};g.move=function(b){var a,e,c,f,g,k;e=b.grid;k=b.swapCoordinates;
b=k.x1;g=k.y1;a=k.x2;k=k.y2;f=l.sizeMatrix(e);c=l.isValidSwapCoordinates({x1:b,y1:g,x2:a,y2:k,range:f});return null!=f&&c?(c=[e[g][b],e[k][a]],e[k][a]=c[0],e[g][b]=c[1],!0):!1};g.moveScore=function(b){var a,c,h;c=b.grid;a=b.dictionary;h=b.swapCoordinates;b=this.words({grid:c,dictionary:a});if(this.move({grid:c,swapCoordinates:h}))return a=this.words({grid:c,dictionary:a}),a=this.newWords({before:b,after:a}),{points:this.scoreWords(a),newWords:a}};g.scoreWord=function(a){var d,e,h,f;h=e=0;for(f=a.length;h<
f;h++)d=a[h],e+=c[d];return e};g.scoreWords=function(a){var d,c,h,f,g;d=[0,a.length];c=d[0];d=d[1];f=0;for(g=a.length;f<g;f++)h=a[f],c+=this.scoreWord(h);return c*d};g.newWords=function(b){var d,c,h,f,g;c=b.before;d=b.after;g=[];h=0;for(f=d.length;h<f;h++)b=d[h],0>a.call(c,b)&&g.push(b);return g}}).call(this);
(function(){var g,k,l,c,f;l=this.Scrabble;c=l.Util;k=l.Score;f=l.WordFinder;g=l.Board=function(){function a(a){var d,e,h,l;e=a.size;l=a.words;d=a.grid;c.isMatrixQuadratic(d)?e=c.sizeMatrix(d):d=void 0;if(!g.isValidSize(e))throw Error("Grid size not given");d||(d=c.generateGrid(e));h=c.wordList({size:e,words:l});this.score=new k({grid:d,dictionary:h});this.size=function(){return e};this.isWord=function(a){return f.isWord({word:a,dictionary:h})};this.move=function(a){return this.score.moveScore(a)};
this.str=function(){return c.printGrid(d)};this.matrix=function(){return c.matrix(d)};this.set=function(a){return c.setCoordinate({coordinates:d,range:e,x:a.x,y:a.y,value:a.value})};this.get=function(a){return c.getCoordinate({coordinates:d,x:a.x,y:a.y})}}a.prototype.inRange=function(a){return c.inRange({value:a,range:this.size()})};return a}();g.isValidSize=function(a){return!a||0>a?!1:!0}}).call(this);
(function(){var g,k,l,c,f,a,b;f=this.Scrabble;g=f.Board;c=f.Player;a=f.Util;b=f.defaultView;k=b();l=f.Game=function(){function b(a){this.words=(null!=a?a:{}).words;if(null==this.words)throw Error("Board or words was not given");}var e;b.prototype["new"]=function(a){var b,d,e,f,l=this;b=null!=a?a:{};f=b.size;d=b.player1;e=b.player2;a=b.board;this.DOM=b.DOM;b=b.VIEW;this.board=a||new g({size:f||5,words:this.words});this.currentPlayer=this.player1=d||new c({name:"Player 1"});this.player2=e||new c({name:"Player 2"});
this.VIEW=b||k;this.move=function(a){l.lastMove=$.extend({},{swapCoordinates:a});a=l.currentPlayer.move({board:l.board,swapCoordinates:a});l.showMessage({score:a});a&&($.extend(l.lastMove,a),l.currentPlayer=l.currentPlayer===l.player1?l.player2:l.player1,l.view.update());return l.lastMove};this.initView();return this};e=function(b){if(null==this.view.selectedTile)return this.view.selectedTile=$.extend({},b),this.view.selectedTile.$el.addClass("selected"),this.showMessage({tile:b});b=a.createSwapCoordinate(this.view.selectedTile.coordinate,
b.coordinate);this.move(b);this.view.selectedTile.$el.removeClass("selected");return this.view.selectedTile=void 0};b.prototype.initView=function(a){var b,d=this;b=(null!=a?a:{}).watchTiles;this.view=new l.View({p1score:this.VIEW.PLAYER.ONE.SCORE,p2score:this.VIEW.PLAYER.TWO.SCORE,p1name:this.VIEW.PLAYER.ONE.NAME,p2name:this.VIEW.PLAYER.TWO.NAME,grid:this.VIEW.GRID,context:this.DOM,game:this});this.view.updatePlayerNames();this.view.update();this.view.watchTiles(function(a){return null!=b?b(a):e.call(d,
a)})};b.prototype.showMessage=function(b){var d,c;c=b.score;b=b.tile;null!=b&&(d=a.Message.tile(b));d||(d=c?a.Message.points({player:this.currentPlayer,score:c}):"Invalid move");l.View.showMessage({message:d,context:this.DOM})};return b}()}).call(this);
(function(){var g,k,l,c,f;l=this.Scrabble;c=l.Util;k=l.Game;l=l.defaultView;g=l();f=k.View=function(){function a(a){var d,c,f,g,k,l;l=null!=a?a:{};f=l.p1score;k=l.p2score;c=l.p1name;g=l.p2name;a=l.context;d=l.grid;this.game=l.game;this.watcherTiles=[];this.$p1name=$("#"+c,a);this.$p1score=$("#"+f,a);this.$p2name=$("#"+g,a);this.$p2score=$("#"+k,a);this.$grid=$("#"+d,a)}a.prototype.updateScore=function(){var a,d,c,f,g;a=null!=(d=this.game)?null!=(c=d.player1)?c.score():void 0:void 0;d=null!=(f=this.game)?
null!=(g=f.player2)?g.score():void 0:void 0;this.$p1score.html(a);return this.$p2score.html(d)};a.prototype.updatePlayerNames=function(){this.$p1name.html(this.game.player1.name());return this.$p2name.html(this.game.player2.name())};a.prototype.updateGrid=function(){var a,d,c,h;this.$grid.empty().append(f.createGrid(this.game.board.matrix()));h=this.watcherTiles;d=0;for(c=h.length;d<c;d++)a=h[d],this.registerWatchTiles(a);return this.$grid};a.prototype.update=function(){this.updateScore();this.updateGrid();
return this};a.prototype.watchTiles=function(a){this.watcherTiles.push(a);return this.registerWatchTiles(a)};a.prototype.registerWatchTiles=function(a){var d,e;d=this.$grid;e={};return d.find("li").on({catchTileInfo:function(h){var g,l,k;g=f.getCoordinate({grid:d,tile:this});k=c.createSwipeCoordinate(g,h.data||{});l=c.createSwapCoordinate(g,k);$.extend(e,{coordinate:g,el:this,$el:$(this)});null!=h.data&&$.extend(e,{swipeCoordinate:k,swapCoordinate:l});return a(e)},click:function(){return $(this).trigger("catchTileInfo")},
swipeRight:function(){return $(this).trigger("catchTileInfo",{x:1})},swipeLeft:function(){return $(this).trigger("catchTileInfo",{x:-1})},swipeUp:function(){return $(this).trigger("catchTileInfo",{y:-1})},swipeDown:function(){return $(this).trigger("catchTileInfo",{y:1})}})};a.prototype.unwatchTiles=function(){this.watcherTiles=[];return this.$grid.find("li").off()};return a}();f.showMessage=function(a){var b;b=null!=a?a:{};a=b.message;return $("#"+(b.id||g.MESSAGE),b.context).html(a)};f.createGridLine=
function(a){var b,d,c,f;b="";c=0;for(f=a.length;c<f;c++)d=a[c],b+="<li>"+d+"</li>";return $(b)};f.createGrid=function(a){var b,c,e,f,g;b=$("<div>");f=0;for(g=a.length;f<g;f++)c=a[f],e=$("<ul>"),b.append(e.append(this.createGridLine(c)));return b.contents()};f.getCoordinate=function(a){var b,c,e;a=$(a.tile);c=a.parent();b=c.children();e=c.parent().children();return{x:b.index(a),y:e.index(c)}}}).call(this);
